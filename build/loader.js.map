{"version":3,"file":"loader.js","sources":["../node_modules/js-cookie/dist/js.cookie.mjs","../src/common/js/constants.js","../src/client/loader.js"],"sourcesContent":["/*! js-cookie v3.0.1 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (key, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    key = encodeURIComponent(key)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      key + '=' + converter.write(value, key) + stringifiedAttributes)\n  }\n\n  function get (key) {\n    if (typeof document === 'undefined' || (arguments.length && !key)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var foundKey = decodeURIComponent(parts[0]);\n        jar[foundKey] = converter.read(value, foundKey);\n\n        if (key === foundKey) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return key ? jar[key] : jar\n  }\n\n  return Object.create(\n    {\n      set: set,\n      get: get,\n      remove: function (key, attributes) {\n        set(\n          key,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport default api;\n","export const ENTER_KEY = 'Enter'\nexport const ESCAPE_KEY = 'Escape'\nexport const SPACE_KEY = ' '\nexport const TAB_KEY = 'Tab'\nexport const L_KEY = 'l'\nexport const ARROWDOWN_KEY = 'ArrowDown'\nexport const ARROWLEFT_KEY = 'ArrowLeft'\nexport const ARROWRIGHT_KEY = 'ArrowRight'\nexport const ARROWUP_KEY = 'ArrowUp'\n","/*\n * @fileOverview Script de chargement de l'application Corvée\n * Chargement des librairies dont dépend celui-ci, puis initialisation *\n * @author <a href = \"mailto:christian.remillard@umontreal.ca\"> Christian Rémillard </a>\n * @preserve\n */\n\nimport Cookie from 'js-cookie'\nimport { baseUrl, version, cookie } from '@corvee/client-config/app'\nimport { L_KEY } from '../common/js/constants.js'\n\nconst role = self === top ? 'master' : 'slave'\n\nlet app\n\nasync function importApp() {\n  return new Promise(async (resolve, reject) => {\n    if (app) {\n      return resolve(app)\n    }\n\n    try {\n      const url = `${baseUrl}/${version}/client/corvee.js`\n      const { corveeApp } = await import(url)\n      app = corveeApp\n      resolve(app)\n    } catch (error) {\n      reject(error)\n    }\n  })\n}\n\nfunction start(notify = false) {\n  console.log('[%s] Starting app from loader', role)\n  importApp()\n    .then(app => app.start(notify))\n    .catch(error => {\n      console.error(`Error loading app: %o`, error)\n    })\n}\n\nfunction stop(notify = false) {\n  if (app) {\n    console.log('[%s] Stopping app from loader', role)\n    app.stop(notify)\n  }\n}\n\nfunction isActive() {\n  const cvCookie = Cookie.get(cookie.name)\n\n  let active = false\n\n  if (cvCookie) {\n    try {\n      active = JSON.parse(cvCookie).isActive\n    } catch (error) {\n      console.error('Error parsing cookie: %o', error)\n    }\n  }\n\n  return active\n}\n\n//\n// Initialisation\n//\n\nwindow.addEventListener('message', function (event) {\n  // console.log('[%s] Got a message: %o', _c.role, event.data)\n  if (typeof event.data === 'object' && 'cv' in event.data && event.data.action) {\n    var msg = event.data\n    console.log('[%s] got a message from %s:  %o', role, role === 'master' ? 'slave' : 'master', msg)\n\n    switch (msg.action) {\n      case 'start':\n        start(false)\n        break\n      case 'stop':\n        stop(false)\n        break\n    }\n  }\n})\n\ndocument.addEventListener('keydown', async function (event) {\n  const altKey = event.altKey\n  if (altKey && event.key === L_KEY) {\n    // alt-l\n    if (isActive()) {\n      stop(true)\n    } else {\n      start(true)\n    }\n  }\n})\n\nif (isActive()) {\n  start()\n}\n"],"names":["Cookie"],"mappings":"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"}